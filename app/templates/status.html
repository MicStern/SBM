<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Status</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { text-align: left; }
    .muted { color: #666; }
    form.inline { display: inline-flex; gap: 8px; align-items: center; }
    input[type="text"] { padding: 4px 6px; }
    button { padding: 4px 8px; cursor: pointer; }
    .grid { display: grid; grid-template-columns: 1fr 2fr; gap: 24px; }
  </style>
</head>
<body>
  <h1>Status</h1>

  <div class="grid">
    <div>
      <h2>Runtime</h2>
      <ul>
        <li>Started: {{ s.started_at }}</li>
        <li>Last Fetch: {{ s.last_fetch_at }}</li>
        <li>Last Save: {{ s.last_save_at }}</li>
        <li>Fetched Total: {{ s.fetched_total }}</li>
        <li>Saved Total: {{ s.saved_total }}</li>
        <li>Fetch Errors: {{ s.fetch_errors }}</li>
        <li>Save Errors: {{ s.save_errors }}</li>
        <li>Queue Size: {{ queue_size }}</li>
      </ul>

      <h2>Analyse</h2>
      <p class="muted">TBD</p>
    </div>
    
    <h2>Fehler-Logs (letzte {{ s.error_logs|length }})</h2>

      {% if s.error_logs %}
      <div style="border:1px solid #ccc; padding:10px; max-height:250px; overflow-y:auto; white-space:pre-wrap; background:#fafafa;">
        {% for log in s.error_logs %}
          â€¢ {{ log }}<br>
        {% endfor %}
      </div>
      {% else %}
      <p class="muted">Keine Fehler bisher.</p>
      {% endif %}

    <div>
      <h2>Pakete (gruppiert: {{ packets|length }})</h2>
      <table>
        <thead>
          <tr>
            <th>packet_id</th>
            <th>Count</th>
            <th>Last Seen</th>
            <th>Label</th>
            <th>Set Label</th>
          </tr>
        </thead>
        <tbody>
        {% for p in packets %}
          <tr>
            <td>{{ p.packet_id }}</td>
            <td>{{ p.count }}</td>
            <td>{{ p.last_seen }}</td>
            <td>{{ p.label or "" }}</td>
            <td>
              <form class="inline" method="post" action="/label">
                <input type="hidden" name="packet_id" value="{{ p.packet_id }}">
                <input type="text" name="label" placeholder="Label eingeben" value="{{ p.label or '' }}">
                <button type="submit">Speichern</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5" class="muted">Noch keine Pakete.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
